{% extends "base.html" %}

{% block content %}

<div class="dashboard-header">
    <span class="date-badge"><i class="fa-regular fa-calendar"></i> {{ today_date }}</span>
    <h1>{{ greeting }}, {{ current_user.username }}!</h1>
    <p>You have <strong>{{ tasks|length }} tasks</strong> pending. Let's get to work.</p>
</div>

<div class="creation-container">
    <div class="form-card" id="taskFormCard">
        <form method="POST">
            {{ form.hidden_tag() }}

            {{ form.title(class="clean-input title-input", id="formTitle", placeholder="Add Title") }}

            {{ form.description(class="clean-input desc-input", id="formDesc", placeholder="Take a note...", rows=1) }}

            <div class="form-footer" id="formFooter">
                <div class="form-options">
                    {{ form.due_date(class="chip-input datepicker", placeholder="select date") }}
                    {{ form.priority(class="chip-input") }}
                    {{ form.category(class="chip-input") }}
                </div>
                {{ form.submit(class="btn-new-task", style="padding: 8px 20px; border-radius: 20px; width: auto; font-size: 0.9rem;") }}
            </div>
        </form>
    </div>
</div>

<h2 style="margin: 40px 0 20px 10px;">My Tasks</h2>

<div class="task-grid">
    {% for task in tasks %}
    <div class="task-card priority-{{ task.priority }}">
        <div>
            <div class="card-top">
                <div class="task-title">{{ task.title }}</div>
                <span style="background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">
                    {{ task.status }}
                </span>
            </div>

            <p class="task-desc">{{ task.description }}</p>

            <div class="task-meta">
                <i class="fa-regular fa-calendar"></i> {{ task.due_date.strftime('%b %d') }}
                <span>â€¢</span>
                <span>{{ task.category }}</span>
            </div>
        </div>

        <a href="{{ url_for('main.delete_task', id=task.id) }}" class="btn-dismiss" title="Dismiss Task">
            <i class="fa-solid fa-trash-can"></i>
        </a>
    </div>
    {% else %}
    <div style="text-align: center; grid-column: 1 / -1; color: var(--text-secondary);">
        <i class="fa-solid fa-mug-hot" style="font-size: 2rem; margin-bottom: 10px;"></i>
        <p>No tasks found. Time to relax!</p>
    </div>
    {% endfor %}
</div>

<script>
    const card = document.getElementById('taskFormCard');
    const titleInput = document.getElementById('formTitle');
    const descInput = document.getElementById('formDesc');
    const footer = document.getElementById('formFooter');

    // When clicking the description box (which acts as the initial "Take a note..." area)
    descInput.addEventListener('focus', () => {
        card.classList.add('active');
        titleInput.style.display = 'block'; // Show title
        footer.style.display = 'flex';      // Show options
        descInput.rows = 3;                 // Expand text area
    });

    // Optional: Close the form if clicking outside (Advanced, can skip for now)
    document.addEventListener('click', (event) => {
        const isClickInside = card.contains(event.target);
        if (!isClickInside && descInput.value === '') {
            // Only collapse if empty
            card.classList.remove('active');
            titleInput.style.display = 'none';
            footer.style.display = 'none';
            descInput.rows = 1;
        }
    });
</script>

<script>
<!--    new Calendar in taskbar-->
    document.addEventListener('DOMContentLoaded', function() {
        flatpickr(".datepicker", {
            dateFormat: "Y-m-d", // Matches Python format
            altInput: true,      // Show readable date
            altFormat: "F j, Y", // e.g. "January 13, 2026"
            allowInput: true,    // Allow manual typing
            animate: true,       // Smooth animation
            disableMobile: "true", // Force custom picker on mobile
            // Optional: Keeps the calendar styling consistent with your material theme
            theme: "material_blue"
        });
    });
</script>

{% endblock %}

